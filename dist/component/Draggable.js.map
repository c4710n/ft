{"version":3,"sources":["../../src/component/Draggable.js"],"names":["Component","Draggable","enableX","enableY","onStart","onMove","onEnd","name","$dragging","$eventData","$pointerdownPosition","displayObject","interactive","on","onDragStart","onDragEnd","onDragMove","off","event","component","data","getLocalPosition","currentPosition","parent","nextX","x","nextY","y","positionDisplayObject","position"],"mappings":"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","sourcesContent":["import Component from './Component'\n\n/**\n * Make a display object draggable.\n *\n * @example\n * const displayObject = FT.create(Text, 'Hello World')\n * const draggable = new Draggable()\n * displayObject.addComponent(draggable)\n */\nclass Draggable extends Component {\n  constructor({ enableX = true, enableY = true, onStart, onMove, onEnd } = {}) {\n    super()\n\n    this.name = 'draggable'\n\n    /**\n     * @access private\n     */\n    this.$dragging = false\n\n    /**\n     * @access private\n     */\n    this.$eventData = null\n\n    /**\n     * @access private\n     */\n    this.$pointerdownPosition = null\n\n    this.enableX = enableX\n    this.enableY = enableY\n    this.onStart = onStart\n    this.onMove = onMove\n    this.onEnd = onEnd\n  }\n\n  onAdded(displayObject) {\n    displayObject.interactive = true\n    displayObject.on('pointerdown', this.onDragStart, this)\n    displayObject.on('pointerup', this.onDragEnd, this)\n    displayObject.on('pointerupoutside', this.onDragEnd, this)\n    displayObject.on('pointermove', this.onDragMove, this)\n  }\n\n  onRemoved(displayObject) {\n    displayObject.interactive = false\n    displayObject.off('pointerdown', this.onDragStart, this)\n    displayObject.off('pointerup', this.onDragEnd, this)\n    displayObject.off('pointerupoutside', this.onDragEnd, this)\n    displayObject.off('pointermove', this.onDragMove, this)\n  }\n\n  /**\n   * @access private\n   */\n  onDragStart(event) {\n    const component = this\n    const { displayObject } = this\n\n    this.$dragging = true\n    this.$eventData = event.data\n\n    // click position relative to current displayObject\n    this.$pointerdownPosition = this.$eventData.getLocalPosition(displayObject)\n\n    component.onStart?.(displayObject)\n  }\n\n  /**\n   * @access private\n   */\n  onDragEnd() {\n    const component = this\n    const { displayObject } = this\n\n    this.$dragging = false\n    this.$eventData = null\n\n    component.onEnd?.(displayObject)\n  }\n\n  /**\n   * @access private\n   */\n  onDragMove() {\n    if (!this.$dragging) return\n    const component = this\n    const { displayObject } = this\n\n    // click position relative to the parent of current displayObject\n    const currentPosition = this.$eventData.getLocalPosition(\n      displayObject.parent\n    )\n\n    const nextX = currentPosition.x - this.$pointerdownPosition.x\n    const nextY = currentPosition.y - this.$pointerdownPosition.y\n\n    if (component.onMove) {\n      component.onMove(displayObject, nextX, nextY)\n    } else {\n      this.positionDisplayObject(nextX, nextY)\n    }\n  }\n\n  positionDisplayObject(x, y) {\n    const { displayObject, enableX, enableY } = this\n\n    if (enableX) {\n      displayObject.position.x = x\n    }\n\n    if (enableY) {\n      displayObject.position.y = y\n    }\n  }\n}\n\nexport default Draggable\n"],"file":"Draggable.js"}