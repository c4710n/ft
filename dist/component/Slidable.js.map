{"version":3,"sources":["../../src/component/Slidable.js"],"names":["Component","clamp","Slidable","direction","min","max","onCompleted","onFailed","name","$dragging","$eventData","$pointerdownLocalY","$previousTimestamp","reset","completed","displayObject","on","onPointerDown","onPointerUp","onPointerMove","off","event","data","getLocalPosition","y","currentY","parent","$previousY","originalEvent","timeStamp","currentTimestamp","$currentY","deltaY","deltaTime","speed","Math","abs","position"],"mappings":"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","sourcesContent":["import Component from './Component'\nimport { clamp } from '../util/math'\n\nclass Slidable extends Component {\n  constructor(direction, { min = -400, max = 0, onCompleted, onFailed } = {}) {\n    super()\n\n    this.name = 'slidable'\n\n    this.$dragging = false\n    this.$eventData = null\n    this.$pointerdownLocalY = 0\n    this.$previousTimestamp = 0\n\n    this.reset(direction, { min, max, onCompleted, onFailed })\n  }\n\n  reset(direction, { min, max, onCompleted, onFailed }) {\n    this.direction = direction\n    this.min = min\n    this.max = max\n    this.completed = false\n    this.onCompleted = onCompleted\n    this.onFailed = onFailed\n  }\n\n  onAdded(displayObject) {\n    displayObject.on('pointerdown', this.onPointerDown, this)\n    displayObject.on('pointerup', this.onPointerUp, this)\n    displayObject.on('pointerupoutside', this.onPointerUp, this)\n    displayObject.on('pointermove', this.onPointerMove, this)\n  }\n\n  onRemoved(displayObject) {\n    displayObject.off('pointerdown', this.onPointerDown, this)\n    displayObject.off('pointerup', this.onPointerUp, this)\n    displayObject.off('pointerupoutside', this.onPointerUp, this)\n    displayObject.off('pointermove', this.onPointerMove, this)\n  }\n\n  onPointerDown(event) {\n    if (this.completed) return\n\n    const { displayObject } = this\n\n    this.$dragging = true\n    this.$eventData = event.data\n\n    // click position relative to current displayObject\n    this.$pointerdownLocalY = this.$eventData.getLocalPosition(displayObject).y\n\n    // displayObject's position relative to its parent\n    const currentY = this.$eventData.getLocalPosition(displayObject.parent).y\n    this.$previousY = currentY - this.$pointerdownLocalY\n\n    this.$previousTimestamp = this.$eventData.originalEvent.timeStamp\n  }\n\n  onPointerMove(event) {\n    if (this.completed) return\n    if (!this.$dragging) return\n\n    const {\n      displayObject,\n      $previousY,\n      $previousTimestamp,\n      direction,\n      min,\n      max,\n      onCompleted,\n    } = this\n\n    const currentY = this.$eventData.getLocalPosition(displayObject.parent).y\n    const currentTimestamp = event.data.originalEvent.timeStamp\n    const $currentY = currentY - this.$pointerdownLocalY\n\n    const deltaY = $currentY - $previousY\n    const deltaTime = currentTimestamp - $previousTimestamp\n    const speed = Math.abs(deltaY / deltaTime)\n\n    const y = clamp($currentY, min, max)\n    displayObject.position.y = y\n\n    if (\n      speed > 1 ||\n      (direction === 'up' && y === min) ||\n      (direction === 'down' && y === max)\n    ) {\n      this.completed = true\n      onCompleted?.({ direction, min, max })\n    }\n  }\n\n  onPointerUp() {\n    this.$dragging = false\n    this.$eventData = null\n\n    const { completed, direction, min, max, onFailed, displayObject } = this\n\n    if (!completed) {\n      if (direction === 'up') {\n        onFailed?.({ direction, min, max })\n        displayObject.position.y = max\n      }\n\n      if (direction === 'down') {\n        onFailed?.({ direction, min, max })\n      }\n    }\n  }\n}\n\nexport default Slidable\n"],"file":"Slidable.js"}