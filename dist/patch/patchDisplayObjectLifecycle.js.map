{"version":3,"sources":["../../src/patch/patchDisplayObjectLifecycle.js"],"names":["app","PIXI","events","patchDisplayObjectMethods","Container","DisplayObject","prototype","$addChild","addChild","$addChildAt","addChildAt","$removeChild","removeChild","_bindComponent","displayObject","component","added","FT_PRODUCTION_MODE","console","log","constructor","name","_onAdded","onUpdate","ticker","add","_unbindComponent","remove","_onRemoved","callPostAdd","container","onAdded","components","Object","values","forEach","onResize","_onResize","call","resize","on","callPostRemove","off","onRemoved","recursiveCallPostAdd","children","c","recursiveCallPostRemove","_addChild","child","_addChildAt","index","_removeChild","initComponents","addComponent","componentName","removeComponent","patchDisplayObjectLifecycle"],"mappings":"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","sourcesContent":["/* global FT_PRODUCTION_MODE */\nimport app from '../app'\nimport { PIXI } from '../core'\nimport events from '../events'\nimport patchDisplayObjectMethods from './patchDisplayObjectMethods'\n\nconst { Container, DisplayObject } = PIXI\n\npatchDisplayObjectMethods(Container.prototype)\n\nContainer.prototype.$addChild = Container.prototype.addChild\nContainer.prototype.$addChildAt = Container.prototype.addChildAt\nContainer.prototype.$removeChild = Container.prototype.removeChild\n\nfunction _bindComponent(displayObject, component) {\n  if (displayObject.added && component.added === false) {\n    component.added = true\n\n    if (!FT_PRODUCTION_MODE) {\n      // eslint-disable-next-line\n      console.log(\n        `[lifecycle] bind component ${component.constructor.name} for ${displayObject.constructor.name}`\n      )\n    }\n\n    component._onAdded(displayObject)\n\n    if (component.onUpdate) {\n      app.ticker.add(component.onUpdate, component)\n    }\n  }\n}\n\nfunction _unbindComponent(displayObject, component) {\n  // no need to check displayObject.added when removing component\n  if (component.added === true) {\n    component.added = false\n\n    if (component.onUpdate) {\n      app.ticker.remove(component.onUpdate, component)\n    }\n\n    component._onRemoved(displayObject)\n\n    if (!FT_PRODUCTION_MODE) {\n      // eslint-disable-next-line\n      console.log(\n        `[lifecycle] unbind component ${component.constructor.name} for ${displayObject.constructor.name}`\n      )\n    }\n  }\n}\n\nfunction callPostAdd(container) {\n  container.added = true\n\n  if (!FT_PRODUCTION_MODE) {\n    console.log('[lifecycle] add', container.constructor.name) // eslint-disable-line\n  }\n\n  if (container.onAdded) {\n    container.onAdded()\n  }\n\n  if (container.components) {\n    Object.values(container.components).forEach((component) => {\n      _bindComponent(container, component)\n    })\n  }\n\n  if (container.onUpdate) {\n    app.ticker.add(container.onUpdate, container)\n  }\n\n  if (container.onResize) {\n    container._onResize = function _onResize() {\n      container.onResize.call(container)\n    }\n    events.resize.on(container._onResize)\n  }\n}\n\nfunction callPostRemove(container) {\n  container.added = false\n\n  if (container.onResize) {\n    events.resize.off(container._onResize)\n  }\n\n  if (container.onUpdate) {\n    app.ticker.remove(container.onUpdate, container)\n  }\n\n  if (container.components) {\n    Object.values(container.components).forEach((component) => {\n      _unbindComponent(container, component)\n    })\n  }\n\n  if (container.onRemoved) {\n    container.onRemoved()\n  }\n\n  if (!FT_PRODUCTION_MODE) {\n    console.log('[lifecycle] remove', container.constructor.name) // eslint-disable-line\n  }\n}\n\nfunction recursiveCallPostAdd(container) {\n  callPostAdd(container)\n\n  container.children.forEach((c) => {\n    recursiveCallPostAdd(c)\n  })\n}\n\nfunction recursiveCallPostRemove(container) {\n  container.children.forEach((c) => {\n    recursiveCallPostRemove(c)\n  })\n\n  callPostRemove(container)\n}\n\nfunction _addChild(child) {\n  this.$addChild(child)\n\n  if (this.added) {\n    recursiveCallPostAdd(child)\n  }\n\n  return child\n}\n\nfunction _addChildAt(child, index) {\n  this.$addChildAt(child, index)\n\n  if (this.added) {\n    recursiveCallPostAdd(child)\n  }\n\n  return child\n}\n\nfunction _removeChild(child) {\n  this.$removeChild(child)\n\n  if (this.added) {\n    recursiveCallPostRemove(child)\n  }\n\n  return child\n}\n\nfunction initComponents() {\n  if (!this.components) {\n    this.components = {}\n  }\n}\n\nfunction addComponent(component) {\n  this.initComponents()\n\n  const componentName = component.name\n  this.components[componentName] = component\n  _bindComponent(this, component)\n\n  return this\n}\n\nfunction removeComponent(component) {\n  this.initComponents()\n\n  const componentName = component.name\n  if (this.components[componentName]) {\n    _unbindComponent(this, component)\n    delete this.components[componentName]\n  }\n\n  return this\n}\n\nexport default function patchDisplayObjectLifecycle() {\n  DisplayObject.prototype.initComponents = initComponents\n  DisplayObject.prototype.addComponent = addComponent\n  DisplayObject.prototype.removeComponent = removeComponent\n\n  Container.prototype.addChild = _addChild\n  Container.prototype.addChildAt = _addChildAt\n  Container.prototype.removeChild = _removeChild\n}\n"],"file":"patchDisplayObjectLifecycle.js"}